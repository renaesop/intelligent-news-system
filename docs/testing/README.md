# æ™ºèƒ½æ–°é—»æ¨èç³»ç»Ÿ - æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æµ‹è¯•æ¶æ„æ¦‚è§ˆ

æœ¬æ–‡æ¡£è®°å½•äº†æ™ºèƒ½æ–°é—»æ¨èç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•æ¶æ„ï¼Œé‡‡ç”¨åˆ†å±‚æµ‹è¯•ç­–ç•¥ç¡®ä¿ç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½ã€‚

## ğŸ—ï¸ æµ‹è¯•ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ services/           # æœåŠ¡å±‚å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ vectorService.test.js        # å‘é‡æœåŠ¡æµ‹è¯•
â”‚   â”‚   â””â”€â”€ recallRankingService.test.js # å¬å›æ’åºæœåŠ¡æµ‹è¯•
â”‚   â””â”€â”€ edge-cases.test.js  # è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†æµ‹è¯•
â”œâ”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ api/               # APIé›†æˆæµ‹è¯•
â”‚   â”‚   â””â”€â”€ api.test.js    # REST APIç«¯ç‚¹æµ‹è¯•
â”‚   â””â”€â”€ workflows/         # å·¥ä½œæµé›†æˆæµ‹è¯•
â”‚       â””â”€â”€ userJourney.test.js # ç”¨æˆ·å®Œæ•´äº¤äº’æµç¨‹æµ‹è¯•
â”œâ”€â”€ performance/           # æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ performance.test.js # ç³»ç»Ÿæ€§èƒ½å’Œè´Ÿè½½æµ‹è¯•
â”œâ”€â”€ fixtures/              # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ testData.js        # æ ‡å‡†åŒ–æµ‹è¯•æ•°æ®é›†
â”œâ”€â”€ helpers/               # æµ‹è¯•å·¥å…·
â”‚   â”œâ”€â”€ mockFactories.js   # Mockå¯¹è±¡å·¥å‚
â”‚   â””â”€â”€ testServer.js      # æµ‹è¯•æœåŠ¡å™¨å·¥å…·
â”œâ”€â”€ scripts/               # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test-runner.js     # ä¸»æµ‹è¯•è¿è¡Œå™¨
â”‚   â”œâ”€â”€ test-recall-ranking.js # å¬å›æ’åºä¸“é¡¹æµ‹è¯•
â”‚   â””â”€â”€ test-vector.js     # å‘é‡åŠŸèƒ½ä¸“é¡¹æµ‹è¯•
â””â”€â”€ setup/                 # æµ‹è¯•é…ç½®
    â”œâ”€â”€ globalSetup.js     # å…¨å±€æµ‹è¯•ç¯å¢ƒè®¾ç½®
    â””â”€â”€ testSequencer.js   # æµ‹è¯•æ‰§è¡Œé¡ºåºæ§åˆ¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npm run test:all
# æˆ–è€…
node tests/scripts/test-runner.js
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
```bash
# å•å…ƒæµ‹è¯•
npm run test:unit

# é›†æˆæµ‹è¯•  
npm run test:integration

# æ€§èƒ½æµ‹è¯•
npm run test:performance
```

### ä¸“é¡¹æµ‹è¯•è„šæœ¬
```bash
# å¬å›æ’åºç³»ç»Ÿä¸“é¡¹æµ‹è¯•
npm run test:recall

# å‘é‡æœç´¢åŠŸèƒ½ä¸“é¡¹æµ‹è¯•
npm run test:vector
```

## ğŸ“Š æµ‹è¯•å¥—ä»¶è¯¦æƒ…

### 1. å•å…ƒæµ‹è¯• (Unit Tests)
**ç›®æ ‡**: æµ‹è¯•ç‹¬ç«‹ç»„ä»¶å’ŒæœåŠ¡çš„åŠŸèƒ½æ­£ç¡®æ€§

#### 1.1 å‘é‡æœåŠ¡æµ‹è¯• (`tests/unit/services/vectorService.test.js`)
- âœ… OpenAIåµŒå…¥ç”Ÿæˆ
- âœ… ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
- âœ… æ–‡ç« å‘é‡å­˜å‚¨å’Œæ£€ç´¢
- âœ… ç”¨æˆ·åå¥½å‘é‡æ„å»º
- âœ… ä¸ªæ€§åŒ–æ¨èç”Ÿæˆ

#### 1.2 å¬å›æ’åºæœåŠ¡æµ‹è¯• (`tests/unit/services/recallRankingService.test.js`)
- âœ… SQLiteç¼“å­˜æ“ä½œ (è¯»å†™ã€è¿‡æœŸã€å¹¶å‘)
- âœ… å¤šé€šé“å¬å› (å‘é‡ã€æ ‡ç­¾ã€ååŒã€çƒ­é—¨)
- âœ… æ··åˆæ’åºç®—æ³• (ç›¸å…³æ€§ã€æ–°é²œåº¦ã€å¤šæ ·æ€§)
- âœ… æ¨èè§£é‡Šç”Ÿæˆ
- âœ… åˆ†é¡µä¸€è‡´æ€§

#### 1.3 è¾¹ç•Œæƒ…å†µæµ‹è¯• (`tests/unit/edge-cases.test.js`)
- âœ… æ•°æ®åº“è¿æ¥å¼‚å¸¸å¤„ç†
- âœ… æ— æ•ˆè¾“å…¥éªŒè¯
- âœ… æ•°æ®æŸåæ¢å¤
- âœ… å†…å­˜é™åˆ¶å¤„ç†
- âœ… å¹¶å‘è®¿é—®æ§åˆ¶
- âœ… å›½é™…åŒ–æ”¯æŒ

### 2. é›†æˆæµ‹è¯• (Integration Tests)
**ç›®æ ‡**: éªŒè¯ç»„ä»¶é—´åä½œå’Œç«¯åˆ°ç«¯åŠŸèƒ½

#### 2.1 APIé›†æˆæµ‹è¯• (`tests/integration/api/api.test.js`)
- âœ… GET /api/articles/recommended - æ¨èæ–‡ç« è·å–
- âœ… POST /api/articles/fetch - RSSæºæŠ“å–
- âœ… POST /api/articles/:id/feedback - ç”¨æˆ·åé¦ˆå¤„ç†
- âœ… GET /api/sources - RSSæºç®¡ç†
- âœ… POST /api/sources - æ·»åŠ æ–°RSSæº
- âœ… GET /api/stats - ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯

#### 2.2 ç”¨æˆ·æµç¨‹æµ‹è¯• (`tests/integration/workflows/userJourney.test.js`)
- âœ… å®Œæ•´ç”¨æˆ·äº¤äº’æµç¨‹
- âœ… å¤šAPIè°ƒç”¨åè°ƒ
- âœ… é”™è¯¯æ¢å¤æœºåˆ¶
- âœ… å“åº”æ ¼å¼éªŒè¯

### 3. æ€§èƒ½æµ‹è¯• (Performance Tests)
**ç›®æ ‡**: éªŒè¯ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡å’Œæ‰©å±•æ€§

#### 3.1 ç³»ç»Ÿæ€§èƒ½æµ‹è¯• (`tests/performance/performance.test.js`)
- âœ… å¹¶å‘æ¨èè¯·æ±‚å¤„ç† (10+ å¹¶å‘ç”¨æˆ·)
- âœ… ç¼“å­˜æ€§èƒ½ä¼˜åŒ–éªŒè¯ (é¦–æ¬¡ vs ç¼“å­˜è¯·æ±‚)
- âœ… å¤§æ•°æ®é›†å¤„ç† (1000+ æ–‡ç« )
- âœ… å‘é‡æœç´¢æ€§èƒ½ (< 200ms)
- âœ… å†…å­˜ä½¿ç”¨ç›‘æ§
- âœ… è´Ÿè½½æµ‹è¯•åœºæ™¯

## ğŸ”§ æµ‹è¯•å·¥å…·å’Œè¾…åŠ©åŠŸèƒ½

### Mockå·¥å‚ (`tests/helpers/mockFactories.js`)
æä¾›æ ‡å‡†åŒ–çš„Mockå¯¹è±¡åˆ›å»ºï¼š
- `mockArticle()` - æ–‡ç« å¯¹è±¡Mock
- `mockUser()` - ç”¨æˆ·å¯¹è±¡Mock
- `mockDatabase()` - æ•°æ®åº“Mock
- `mockVectorService()` - å‘é‡æœåŠ¡Mock

### æµ‹è¯•æ•°æ® (`tests/fixtures/testData.js`)
é¢„å®šä¹‰çš„æµ‹è¯•æ•°æ®é›†ï¼š
- `testArticles` - æ ‡å‡†æµ‹è¯•æ–‡ç« é›†
- `testUsers` - æµ‹è¯•ç”¨æˆ·æ•°æ®
- `testVectors` - å‘é‡æµ‹è¯•æ•°æ®

### æµ‹è¯•æœåŠ¡å™¨ (`tests/helpers/testServer.js`)
å¿«é€Ÿåˆ›å»ºæµ‹è¯•ç”¨Expressåº”ç”¨çš„å·¥å…·å‡½æ•°ã€‚

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡

ç›®æ ‡è¦†ç›–ç‡æŒ‡æ ‡ï¼š
- **åˆ†æ”¯è¦†ç›–ç‡**: 70%+
- **å‡½æ•°è¦†ç›–ç‡**: 75%+
- **è¡Œè¦†ç›–ç‡**: 80%+
- **è¯­å¥è¦†ç›–ç‡**: 80%+

æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Šï¼š
```bash
npm run test:coverage
open coverage/index.html
```

## ğŸ› æµ‹è¯•è°ƒè¯•

### å•ç‹¬è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
jest tests/unit/services/vectorService.test.js

# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
jest -t "should generate embedding"

# è°ƒè¯•æ¨¡å¼
node --inspect-brk node_modules/.bin/jest tests/unit/services/vectorService.test.js
```

### å¸¸è§é—®é¢˜æ’æŸ¥

1. **OpenAI APIé”™è¯¯**: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `OPENAI_API_KEY`
2. **æ•°æ®åº“é”å®š**: ç¡®ä¿æµ‹è¯•é—´æ­£ç¡®æ¸…ç†æ•°æ®åº“è¿æ¥
3. **è¶…æ—¶é”™è¯¯**: è°ƒæ•´ `jest.config.js` ä¸­çš„ `testTimeout` è®¾ç½®
4. **Mocké—®é¢˜**: ç¡®ä¿åœ¨ `beforeEach` ä¸­é‡ç½®æ‰€æœ‰Mock

## ğŸ“‹ æŒç»­é›†æˆ

### GitHub Actionsé…ç½®
æµ‹è¯•åœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è¿è¡Œï¼š
- PRæäº¤æ—¶
- åˆå¹¶åˆ°ä¸»åˆ†æ”¯æ—¶
- æ¯æ—¥å®šæ—¶ä»»åŠ¡

### CIæµ‹è¯•å‘½ä»¤
```bash
npm run test:ci
```

## ğŸ”„ æµ‹è¯•ç»´æŠ¤

### æ·»åŠ æ–°æµ‹è¯•
1. ç¡®å®šæµ‹è¯•ç±»å‹ï¼ˆå•å…ƒ/é›†æˆ/æ€§èƒ½ï¼‰
2. é€‰æ‹©åˆé€‚çš„ç›®å½•
3. ä½¿ç”¨ç°æœ‰çš„Mockå·¥å‚å’Œæµ‹è¯•æ•°æ®
4. æ›´æ–°æ­¤æ–‡æ¡£

### æµ‹è¯•æ›´æ–°æœ€ä½³å®è·µ
- ä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§å’Œå¯é‡å¤æ€§
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- åŠæ—¶æ›´æ–°æµ‹è¯•ä»¥åæ˜ ä»£ç å˜æ›´
- å®šæœŸæ£€æŸ¥å’Œä¼˜åŒ–æµ‹è¯•æ€§èƒ½

---

## ğŸ“ è”ç³»å’Œæ”¯æŒ

å¦‚æœ‰æµ‹è¯•ç›¸å…³é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æµ‹è¯•è¾“å‡ºæ—¥å¿—
2. æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
3. Jestå®˜æ–¹æ–‡æ¡£
4. é¡¹ç›®issue tracker